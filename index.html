<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>SLIS v6.0 - Informe de Vulnerabilidad</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f4f4f4;
      margin: 20px;
    }

    .formulario,
    #informeCompleto {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input[type="text"],
    textarea,
    input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .portada-ejecutiva {
      background-color: #001f3f;
      color: white;
      padding: 40px;
      text-align: center;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    .portada-ejecutiva h1 {
      font-size: 36px;
    }

    .portada-ejecutiva h2 {
      font-size: 24px;
    }

    .preview-imagen img,
    .imagen-informe {
      max-width: 100%;
      height: auto;
      margin-top: 10px;
      border-radius: 6px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.2);
    }

    p,
    td,
    th,
    textarea {
      text-align: justify;
    }

    button {
      padding: 10px 20px;
      background-color: #001f3f;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>

<body>

  <!-- FORMULARIO -->
  <div class="formulario" id="formularioSLIS">
    <h2>Formulario de Vulnerabilidad</h2>

    <label for="sitio">Nombre del sitio:</label>
    <input type="text" id="sitio">

    <label for="responsable">Responsable del informe:</label>
    <input type="text" id="responsable">

    <label for="entorno">Descripción del entorno:</label>
    <textarea id="entorno"></textarea>

    <label for="fotoEntorno">Fotografía del entorno:</label>
    <input type="file" id="fotoEntorno" accept="image/*" onchange="mostrarImagen(event, 'previewEntorno')">
    <div id="previewEntorno" class="preview-imagen"></div>

    <label for="activos">Activos vulnerables:</label>
    <textarea id="activos"></textarea>

    <label for="fotoActivos">Fotografía de activos:</label>
    <input type="file" id="fotoActivos" accept="image/*" onchange="mostrarImagen(event, 'previewActivos')">
    <div id="previewActivos" class="preview-imagen"></div>

    <label for="hallazgos">Hallazgos:</label>
    <textarea id="hallazgos"></textarea>

    <label for="fotoHallazgo">Fotografía del hallazgo:</label>
    <input type="file" id="fotoHallazgo" accept="image/*" onchange="mostrarImagen(event, 'previewHallazgo')">
    <div id="previewHallazgo" class="preview-imagen"></div>

    <label for="riesgos">Riesgos asociados:</label>
    <textarea id="riesgos"></textarea>

    <label for="recomendaciones">Recomendaciones:</label>
    <textarea id="recomendaciones"></textarea>

    <button onclick="generarInforme()">Generar Informe Ejecutivo</button>
  </div>

  <!-- INFORME -->
  <div id="informeCompleto" style="display:none;">
    <div class="portada-ejecutiva">
      <h1>Informe de Vulnerabilidad</h1>
      <h2>SLIS v6.0</h2>
      <p><strong>Sitio:</strong> <span id="informeSitio"></span></p>
      <p><strong>Fecha:</strong> <span id="informeFecha"></span></p>
      <p><strong>Responsable:</strong> <span id="informeResponsable"></span></p>
    </div>

    <div id="contenidoInforme"></div>

    <button onclick="descargarPDF()">Descargar Informe en PDF</button>
  </div>

  <script>
    const imagenes = {};

    function mostrarImagen(event, contenedorId) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        imagenes[contenedorId] = e.target.result;
        const img = document.createElement("img");
        img.src = e.target.result;
        img.className = "imagen-informe";
        document.getElementById(contenedorId).innerHTML = "";
        document.getElementById(contenedorId).appendChild(img);
      };
      if (file) reader.readAsDataURL(file);
    }

    function generarInforme() {
      const sitio = document.getElementById("sitio")?.value || "Sin especificar";
      const responsable = document.getElementById("responsable")?.value || "Sin responsable";
      const fecha = new Date().toLocaleDateString();

      const entorno = document.getElementById("entorno")?.value || "";
      const activos = document.getElementById("activos")?.value || "";
      const hallazgos = document.getElementById("hallazgos")?.value || "";
      const riesgos = document.getElementById("riesgos")?.value || "";
      const recomendaciones = document.getElementById("recomendaciones")?.value || "";

      document.getElementById("informeSitio").innerText = sitio;
      document.getElementById("informeResponsable").innerText = responsable;
      document.getElementById("informeFecha").innerText = fecha;

      let html = `
        <h3>Entorno</h3><p>${entorno}</p>${imagenHTML('previewEntorno')}
        <h3>Activos Vulnerables</h3><p>${activos}</p>${imagenHTML('previewActivos')}
        <h3>Hallazgos</h3><p>${hallazgos}</p>${imagenHTML('previewHallazgo')}
        <h3>Riesgos</h3><p>${riesgos}</p>
        <h3>Recomendaciones</h3><p>${recomendaciones}</p>
      `;

      document.getElementById("contenidoInforme").innerHTML = html;
      document.getElementById("formularioSLIS").style.display = "none";
      document.getElementById("informeCompleto").style.display = "block";
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function imagenHTML(id) {
      return imagenes[id] ? `<img src="${imagenes[id]}" class="imagen-informe">` : "";
    }

    function descargarPDF() {
      const elemento = document.getElementById("informeCompleto");
      const opciones = {
        margin: 0.5,
        filename: 'Informe_SLIS.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opciones).from(elemento).save();
    }
  </script>
</body>

</html>